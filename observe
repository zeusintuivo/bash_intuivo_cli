#!/usr/bin/env sh
[ -z ${1} ] && echo "Expected at least one parameter for filename to observe!." && exit 1
typeset cwd=$(pwd | sed 's@/@\\/@g')
nodemon --watch "./" --ext bash,sh,php --exec "$(pwd)/${*}" 2>&1  \
| sed --unbuffered 's/\ on\ line\ /:/g' \
| sed --unbuffered 's/:\ line\ /:/g' \
| sed --unbuffered 's/\ No\ such\ file\ or\ directory\ in\ /\ in\ \o033[38;5;213m/g' \
| sed --unbuffered 's/ErrorException:\ /\o033[38;5;196mErrorException:\ \o033[38;5;213m/g' \
 | sed --unbuffered "s/\ require_once(.\/wp-content/\ require_once(\n$cwd\/wp-content/g" \
 | sed --unbuffered "s/\ require(.\/wp-content/\ require(\n$cwd\/wp-content/g" \
 | sed --unbuffered "s/\ require\ .\/wp-content/\ require\ \n$cwd\/wp-content/g" \
 | sed --unbuffered "s/\ include\ .\/wp-content/\ include\ \n$cwd\/wp-content/g" \
 | sed --unbuffered "s/\ include_once(.\/wp-content/\ include_once(\n$cwd\/wp-content/g" \
 | sed --unbuffered "s/\ in\ \//\ in\ \n\//g" \
| sed --unbuffered 's/Stack\ trace:/\o033[38;0mStack\ trace:/g' \
| sed --unbuffered 's/Call\ Stack:/\o033[38;0mCall\ Stack:/g' \

# | sed --unbuffered 's@/./@/@g' \

